<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GarmentPay Hub — Admin</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Supabase JS v2 (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // GANTI dengan kredensial project Supabase kamu
    const SUPABASE_URL = "https://rfharywjzybciqiiovpx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmaGFyeXdqenliY2lxaWlvdnB4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMTY2NTYsImV4cCI6MjA3MzY5MjY1Nn0.M0nwkiUepqsUiR1yKj7i7Mg7WfmFG8JQ2n12yRitSqw";

    // Init client
    window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>
</head>
<body class="bg-slate-100 min-h-screen">
  <div class="max-w-6xl mx-auto p-6" id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const supabase = window.supabaseClient;

    function AddWorkerForm({ onSubmit }) {
      const [name, setName] = useState("");
      const [role, setRole] = useState("Penjahit");
      const [phone, setPhone] = useState("");

      const submit = async (e) => {
        e.preventDefault();
        if (!name.trim()) return;
        await onSubmit({ name, role, phone: phone || null, status: "Aktif" });
        setName("");
        setRole("Penjahit");
        setPhone("");
      };

      return (
        <form onSubmit={submit} className="p-4 rounded-2xl bg-white shadow">
          <div className="font-semibold mb-2">Tambah karyawan</div>
          <div className="grid md:grid-cols-3 gap-3">
            <input className="border rounded-xl px-3 py-2 w-full" placeholder="Nama"
                   value={name} onChange={(e)=>setName(e.target.value)} />
            <select className="border rounded-xl px-3 py-2 w-full" value={role} onChange={(e)=>setRole(e.target.value)}>
              <option>Penjahit</option>
              <option>Pemotong</option>
              <option>Finishing</option>
              <option>Admin</option>
            </select>
            <input className="border rounded-xl px-3 py-2 w-full" placeholder="No. HP (opsional)"
                   value={phone} onChange={(e)=>setPhone(e.target.value)} />
          </div>
          <div className="mt-3">
            <button className="px-4 py-2 rounded-xl bg-slate-900 text-white">Simpan</button>
          </div>
        </form>
      );
    }

    function AdminApp() {
      const [workers, setWorkers] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        (async () => {
          const { data, error } = await supabase
            .from("workers")
            .select("*")
            .order("created_at", { ascending: false });
          if (!error) setWorkers(data || []);
          setLoading(false);
        })();
      }, []);

      async function addWorker(payload) {
        const { data, error } = await supabase.from("workers").insert(payload).select();
        if (error) { alert(error.message); return; }
        setWorkers(prev => [data[0], ...prev]);
      }

      async function addAdvance(worker_id, amount, note = "") {
        const { error } = await supabase.from("advances").insert({ worker_id, amount, note });
        if (error) alert(error.message); else alert("Kasbon tercatat");
      }

      async function addWorkLog(worker_id, item_name, qty, rate) {
        const { error } = await supabase.from("work_logs").insert({ worker_id, item_name, qty, rate });
        if (error) alert(error.message); else alert("Log kerja tersimpan");
      }

      if (loading) return <div className="p-6">Loading...</div>;

      return (
        <div>
          <h1 className="text-2xl font-bold mb-1">Admin Dashboard — GarmentPay Hub</h1>
          <p className="text-slate-600 mb-6">Prototype terhubung ke Supabase (internal use)</p>

          <AddWorkerForm onSubmit={addWorker} />

          <div className="grid md:grid-cols-2 gap-4 mt-6">
            {workers.map(w => (
              <div key={w.id} className="p-4 rounded-2xl bg-white shadow">
                <div className="font-semibold">{w.name}</div>
                <div className="text-sm text-slate-600">{w.role} • {w.status}</div>
                {w.phone && <div className="text-sm text-slate-600">HP: {w.phone}</div>}

                <div className="flex flex-wrap gap-2 mt-3">
                  <button className="px-3 py-2 rounded-xl bg-slate-900 text-white"
                          onClick={() => addAdvance(w.id, 50000, "Kasbon cepat")}>
                    + Kasbon 50k
                  </button>
                  <button className="px-3 py-2 rounded-xl bg-slate-200"
                          onClick={() => addWorkLog(w.id, "Gamis A", 10, 3000)}>
                    + Log Kerja (Gamis A x10)
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<AdminApp />);
  </script>
</body>
</html>
